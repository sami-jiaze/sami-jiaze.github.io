(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{575:function(C,P,t){"use strict";t.r(P);var r=t(2),_=Object(r.a)({},(function(){var C=this,P=C._self._c;return P("ContentSlotsDistributor",{attrs:{"slot-key":C.$parent.slotKey}},[P("h2",{attrs:{id:"什么是dhcp"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#什么是dhcp"}},[C._v("#")]),C._v(" 什么是DHCP")]),C._v(" "),P("p",[C._v("动态主机配置协议DHCP（Dynamic Host Configuration Protocol）是一种网络管理协议，用于集中对用户IP地址进行动态管理和配置。前身是BOOTP协议，是一个局域网的网络协议，使用"),P("strong",[C._v("UDP协议")]),C._v("工作，统一使用两个IANA分配的端口：67（服务器端），68（客户端），是一个不需要账号密码登录的、自动给内网机器分配IP地址等信息的协议。")]),C._v(" "),P("h2",{attrs:{id:"为什么要使用dhcp"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#为什么要使用dhcp"}},[C._v("#")]),C._v(" 为什么要使用DHCP")]),C._v(" "),P("p",[C._v("在IP网络中，每个连接Internet的设备都需要分配唯一的IP地址。DHCP使网络管理员能从中心结点监控和分配IP地址。当某台计算机移到网络中的其它位置时，能自动收到新的IP地址。DHCP实现的自动化分配IP地址不仅降低了配置和部署设备的时间，同时也降低了发生配置错误的可能性。另外DHCP服务器可以管理多个网段的配置信息，当某个网段的配置发生变化时，管理员只需要更新DHCP服务器上的相关配置即可，实现了集中化管理。")]),C._v(" "),P("h2",{attrs:{id:"dhcp使用场景"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#dhcp使用场景"}},[C._v("#")]),C._v(" DHCP使用场景")]),C._v(" "),P("ul",[P("li",[P("p",[C._v("动态分配机制：通过DHCP为主机分配一个有使用期限的IP地址。")]),C._v(" "),P("p",[C._v("DHCP使用了租期的概念，或称为设备IP地址的有效期。租用时间是不定的，主要取决于用户在某地连接Internet需要多久，这种分配机制适用于主机需要临时接入网络或者空闲地址数小于网络主机总数且主机不需要永久连接网络的场景。")])]),C._v(" "),P("li",[P("p",[C._v("静态分配机制：网络管理员通过DHCP为指定的主机分配固定的IP地址。")]),C._v(" "),P("p",[C._v("相比手工静态配置IP地址，通过DHCP方式静态分配机制避免人工配置发生错误，方便管理员统一维护管理。")])])]),C._v(" "),P("h2",{attrs:{id:"dhcp工作原理"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#dhcp工作原理"}},[C._v("#")]),C._v(" DHCP工作原理")]),C._v(" "),P("p",[P("img",{attrs:{src:"E:%5CHTMLCSSJavaScript%5CmyBlog%5CJiaze-blog%5Cdocs%5C%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86%5C%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8E%E8%AE%A1%E7%BD%91%5CDHCP.assets%5Cimage-20230316075329618.png",alt:"image-20230316075329618"}})]),C._v(" "),P("p",[C._v("第一步：发现阶段")]),C._v(" "),P("p",[C._v("首次接入网络的DHCP客户端不知道DHCP服务器的IP地址，为了学习到DHCP服务器的IP地址，DHCP 客户端将该 IP 数据报传递给链路层，链路层然后将帧广播到所有的网络中设备。（包括DHCP服务器或中继）。DHCP DISCOVER报文中携带了客户端的MAC地址chaddr字段、需要请求的参数列表选项Option55、广播标志位flags字段等信息。")]),C._v(" "),P("p",[C._v("第二步：提供阶段")]),C._v(" "),P("p",[C._v("与DHCP客户端位于同一网段的DHCP服务器都会接收到DHCP DISCOVER报文，DHCP服务器选择跟接收DHCP DISCOVER报文接口的IP地址处于同一网段的地址池，并且从中选择一个可用的IP地址，然后通过DHCP OFFER报文发送给DHCP客户端。")]),C._v(" "),P("p",[C._v("通常，DHCP服务器的地址池中会指定IP地址的"),P("a",{attrs:{href:"https://support.huawei.com/hedex/hdx.do?docid=EDOC1100087046&id=ZH-CN_CONCEPT_0176371534&lang=zh",target:"_blank",rel:"noopener noreferrer"}},[C._v("租期"),P("OutboundLink")],1),C._v("，如果DHCP客户端发送的DHCP DISCOVER报文中携带了期望租期，服务器会将客户端请求的期望租期与其指定的租期进行比较，选择其中时间较短的租期分配给客户端。")]),C._v(" "),P("p",[C._v("DHCP服务器在地址池中为客户端分配IP地址的顺序如下：")]),C._v(" "),P("ol",[P("li",[C._v("DHCP服务器上已配置的与客户端MAC地址静态绑定的IP地址。")]),C._v(" "),P("li",[C._v("客户端发送的DHCP DISCOVER报文中"),P("a",{attrs:{href:"https://support.huawei.com/hedex/pages/EDOC1100087046AZJ0324D/10/EDOC1100087046AZJ0324D/10/resources/dc/dc_cfg_dhcp_6005.html#ZH-CN_CONCEPT_0176371535__op50",target:"_blank",rel:"noopener noreferrer"}},[C._v("Option50"),P("OutboundLink")],1),C._v("（请求IP地址选项）指定的地址。")]),C._v(" "),P("li",[C._v("地址池内查找“Expired”状态的IP地址，即曾经分配给客户端的超过租期的IP地址。")]),C._v(" "),P("li",[C._v("在地址池内随机查找一个“Idle”状态的IP地址。")]),C._v(" "),P("li",[C._v("如果未找到可供分配的IP地址，则地址池依次自动回收超过租期的（“Expired”状态）和处于冲突状态（“Conflict”状态）的IP地址。回收后如果找到可用的IP地址，则进行分配；"),P("strong",[C._v("否则，DHCP客户端等待应答超时后，重新发送DHCP DISCOVER报文来申请IP地址")]),C._v("。")])]),C._v(" "),P("p",[C._v("设备支持在地址池中排除某些不能通过DHCP机制进行分配的IP地址。例如，客户端所在网段已经手工配置了地址为192.168.1.100/24的DNS服务器，DHCP服务器上配置的网段为192.168.1.0/24的地址池中需要将192.168.1.100的IP地址排除，不能通过DHCP分配此地址，否则，会造成地址冲突。")]),C._v(" "),P("p",[C._v("为了防止分配出去的IP地址跟网络中其他客户端的IP地址冲突，DHCP服务器在发送DHCP OFFER报文前通过发送源地址为DHCP服务器IP地址、目的地址为预分配出去IP地址的"),P("a",{attrs:{href:"https://info.support.huawei.com/info-finder/encyclopedia/zh/ICMP.html",target:"_blank",rel:"noopener noreferrer"}},[C._v("ICMP"),P("OutboundLink")],1),C._v(" ECHO REQUEST报文对分配的IP地址进行"),P("strong",[C._v("地址冲突探测")]),C._v("。如果在指定的时间内没有收到应答报文，表示网络中没有客户端使用这个IP地址，可以分配给客户端；如果指定时间内收到应答报文，表示网络中已经存在使用此IP地址的客户端，则把此地址列为冲突地址，然后等待重新接收到DHCP DISCOVER报文后按照前面介绍的选择IP地址的优先顺序重新选择可用的IP地址。")]),C._v(" "),P("p",[C._v("此阶段DHCP服务器分配给客户端的IP地址不一定是最终确定使用的IP地址，因为DHCP OFFER报文发送给客户端等待16秒后如果没有收到客户端的响应，此地址就可以继续分配给其他客户端。通过下面的选择阶段和确认阶段后才能最终确定客户端可以使用的IP地址。")]),C._v(" "),P("p",[C._v("第三步：选择阶段")]),C._v(" "),P("p",[C._v("如果有多个DHCP服务器向DHCP客户端回应DHCP OFFER报文，则DHCP客户端一般只接收第一个收到的DHCP OFFER报文，然后以广播方式发送DHCP REQUEST报文，该报文中包含客户端想选择的DHCP服务器标识符（即"),P("a",{attrs:{href:"https://support.huawei.com/hedex/pages/EDOC1100087046AZJ0324D/10/EDOC1100087046AZJ0324D/10/resources/dc/dc_cfg_dhcp_6005.html#ZH-CN_CONCEPT_0176371535__op54",target:"_blank",rel:"noopener noreferrer"}},[C._v("Option54"),P("OutboundLink")],1),C._v("）和客户端IP地址（即"),P("a",{attrs:{href:"https://support.huawei.com/hedex/pages/EDOC1100087046AZJ0324D/10/EDOC1100087046AZJ0324D/10/resources/dc/dc_cfg_dhcp_6005.html#ZH-CN_CONCEPT_0176371535__op50",target:"_blank",rel:"noopener noreferrer"}},[C._v("Option50"),P("OutboundLink")],1),C._v("，填充了接收的DHCP OFFER报文中yiaddr字段的IP地址）。")]),C._v(" "),P("p",[C._v("DHCP客户端广播发送DHCP REQUEST报文通知所有的DHCP服务器，它将选择某个DHCP服务器提供的IP地址，其他DHCP服务器可以重新将曾经分配给客户端的IP地址分配给其他客户端。")]),C._v(" "),P("p",[C._v("第四步：确认阶段")]),C._v(" "),P("p",[C._v("当DHCP服务器收到DHCP客户端发送的DHCP REQUEST报文后，DHCP服务器回应DHCP ACK报文，表示DHCP REQUEST报文中请求的IP地址（"),P("a",{attrs:{href:"https://support.huawei.com/hedex/pages/EDOC1100087046AZJ0324D/10/EDOC1100087046AZJ0324D/10/resources/dc/dc_cfg_dhcp_6005.html#ZH-CN_CONCEPT_0176371535__op50",target:"_blank",rel:"noopener noreferrer"}},[C._v("Option50"),P("OutboundLink")],1),C._v("填充的）分配给客户端使用。")]),C._v(" "),P("p",[C._v("DHCP客户端收到DHCP ACK报文，会广播发送免费ARP报文，探测本网段是否有其他终端使用服务器分配的IP地址，如果在指定时间内没有收到回应，表示客户端可以使用此地址。如果收到了回应，说明有其他终端使用了此地址，客户端会向服务器发送DHCP DECLINE报文，并重新向服务器请求IP地址，同时，服务器会将此地址列为冲突地址。当服务器没有空闲地址可分配时，再选择冲突地址进行分配，尽量减少分配出去的地址冲突。")]),C._v(" "),P("p",[C._v("当DHCP服务器收到DHCP客户端发送的DHCP REQUEST报文后，如果DHCP服务器由于某些原因（例如协商出错或者由于发送REQUEST过慢导致服务器已经把此地址分配给其他客户端）无法分配DHCP REQUEST报文中"),P("a",{attrs:{href:"https://support.huawei.com/hedex/pages/EDOC1100087046AZJ0324D/10/EDOC1100087046AZJ0324D/10/resources/dc/dc_cfg_dhcp_6005.html#ZH-CN_CONCEPT_0176371535__op50",target:"_blank",rel:"noopener noreferrer"}},[C._v("Option50"),P("OutboundLink")],1),C._v("填充的IP地址，则发送DHCP NAK报文作为应答，通知DHCP客户端无法分配此IP地址。DHCP客户端需要重新发送DHCP DISCOVER报文来申请新的IP地址。")]),C._v(" "),P("h2",{attrs:{id:"中继器场景"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#中继器场景"}},[C._v("#")]),C._v(" 中继器场景")]),C._v(" "),P("p",[C._v("如果 DHCP 服务器和客户端不是在同一个局域网内，路由器又不会转发广播包，为了解决这一问题，就出现了 "),P("strong",[C._v("DHCP 中继代理")]),C._v("。有了 DHCP 中继代理以后，"),P("strong",[C._v("对不同网段的 IP 地址分配也可以由一个 DHCP 服务器统一进行管理。")])]),C._v(" "),P("p",[P("img",{attrs:{src:"E:%5CHTMLCSSJavaScript%5CmyBlog%5CJiaze-blog%5Cdocs%5C%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86%5C%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8E%E8%AE%A1%E7%BD%91%5CDHCP.assets%5C7dhcp.png",alt:"7dhcp"}})]),C._v(" "),P("h2",{attrs:{id:"两步交互"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#两步交互"}},[C._v("#")]),C._v(" 两步交互")]),C._v(" "),P("p",[P("strong",[C._v("DHCP客户端重用曾经使用过的地址的工作原理")])]),C._v(" "),P("p",[C._v("DHCP客户端非首次接入网络时，可以重用曾经使用过的地址。如下图所示，DHCP客户端与DHCP服务器交互DHCP报文，以重新获取之前使用的IP地址等网络参数，该过程称为两步交互")]),C._v(" "),P("img",{staticStyle:{zoom:"170%"},attrs:{src:"E:\\HTMLCSSJavaScript\\myBlog\\Jiaze-blog\\docs\\笔记整理\\浏览器与计网\\DHCP.assets\\8dhcp.png",alt:"8dhcp"}}),C._v(" "),P("h2",{attrs:{id:"更新租期"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#更新租期"}},[C._v("#")]),C._v(" 更新租期")]),C._v(" "),P("p",[C._v("DHCP服务器采用动态分配机制给客户端分配IP地址时，分配出去的IP地址有租期限制。DHCP客户端向服务器申请地址时可以携带期望租期，服务器在分配租期时把客户端期望租期和地址池中租期配置比较，分配其中一个较短的租期给客户端。租期到期或者客户端下线释放地址后，服务器会收回该IP地址，收回的IP地址可以继续分配给其他客户端使用。这种机制可以提高IP地址的利用率，避免客户端下线后IP地址继续被占用。如果DHCP客户端希望继续使用该地址，需要更新IP地址的租期（如延长IP地址租期）。")]),C._v(" "),P("img",{staticStyle:{zoom:"180%"},attrs:{src:"E:\\HTMLCSSJavaScript\\myBlog\\Jiaze-blog\\docs\\笔记整理\\浏览器与计网\\DHCP.assets\\4dhcp.png",alt:"4dhcp"}}),C._v(" "),P("ul",[P("li",[P("p",[C._v("当租期达到50%（T1）时，DHCP客户端会自动以单播的方式向DHCP服务器发送DHCP REQUEST报文，请求更新IP地址租期。如果收到DHCP服务器回应的DHCP ACK报文，则租期更新成功（即租期从0开始计算）；如果收到DHCP NAK报文，则重新发送DHCP DISCOVER报文请求新的IP地址。")])]),C._v(" "),P("li",[P("p",[C._v("当租期达到87.5%（T2）时，如果仍未收到DHCP服务器的应答，DHCP客户端会自动以广播的方式向DHCP服务器发送DHCP REQUEST报文，请求更新IP地址租期。如果收到DHCP服务器回应的DHCP ACK报文，则租期更新成功（即租期从0开始计算）；如果收到DHCP NAK报文，则重新发送DHCP DISCOVER报文请求新的IP地址。")])]),C._v(" "),P("li",[P("p",[C._v("如果租期时间到时都没有收到服务器的回应，客户端停止使用此IP地址，重新发送DHCP DISCOVER报文请求新的IP地址。")])])]),C._v(" "),P("p",[C._v("客户端在租期时间到之前，如果用户不想使用分配的IP地址（例如客户端网络位置需要变更），会触发DHCP客户端向DHCP服务器发送DHCP RELEASE报文，通知DHCP服务器释放IP地址的租期。DHCP服务器会保留这个DHCP客户端的配置信息，将IP地址列为曾经分配过的IP地址中，以便后续重新分配给该客户端或其他客户端。客户端可以通过发送DHCP INFORM报文向服务器请求更新配置信息。")]),C._v(" "),P("h2",{attrs:{id:"参考"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[C._v("#")]),C._v(" 参考")]),C._v(" "),P("p",[C._v("小林coding")]),C._v(" "),P("p",[P("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/265293856",target:"_blank",rel:"noopener noreferrer"}},[C._v("DHCP协议详解 - 知乎 (zhihu.com)"),P("OutboundLink")],1)]),C._v(" "),P("p",[P("a",{attrs:{href:"https://info.support.huawei.com/info-finder/encyclopedia/zh/DHCP.html",target:"_blank",rel:"noopener noreferrer"}},[C._v("什么是DHCP？为什么要用DHCP？ - 华为 (huawei.com)"),P("OutboundLink")],1)])])}),[],!1,null,null,null);P.default=_.exports}}]);