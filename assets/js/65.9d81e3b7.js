(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{656:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),s("p",[t._v("词法环境、执行上下文、作用域、闭包笔记总结")])]),t._v(" "),s("h2",{attrs:{id:"词法环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#词法环境"}},[t._v("#")]),t._v(" 词法环境")]),t._v(" "),s("p",[t._v("在 JavaScript 中，词法环境（Lexical Environment）是表示变量和函数标识符（Identifier）绑定的集合，使得 JavaScript 引擎可以通过标识符找到对应的变量值和函数。词法环境也是变量和函数的作用域（Scope）。")]),t._v(" "),s("p",[t._v("一个词法环境可以有一个或多个父级词法环境，形成一个词法环境链（Lexical Environment Chain）。这个链条在执行 JavaScript 代码时进行查找，直到找到目标标识符绑定的值或到达全局环境为止。全局环境的词法环境链上不存在任何父级词法环境。")]),t._v(" "),s("p",[t._v("JavaScript 中的词法环境可以分为"),s("strong",[t._v("三种类型")]),t._v("：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("全局环境（Global Environment）")])])]),t._v(" "),s("p",[t._v("全局环境是最外层的词法环境，它不是函数内的环境，也不是代码块内的环境，是 JavaScript 程序可访问的最大的环境。全局环境可以访问所有的对象和函数，在浏览器环境中它是 window 对象，在 node 环境中是 global 对象。全局环境只有它自己，没有父级环境。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("函数环境（Function Environment）")])])]),t._v(" "),s("p",[t._v("每个函数都有自己的词法环境，又称为函数环境。函数环境有它自己的作用域，可以访问整个函数内部的变量和函数，也可以访问外部词法环境中的变量和函数。函数环境可以看作是一种子级环境，它的父级环境就是创建这个函数的词法环境。如果这个函数是以函数表达式方式声明的，那么父级环境就是调用它的上下文的词法环境。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("块级环境（Block Environment）")])])]),t._v(" "),s("p",[t._v("块级环境也就是代码块中的环境，它只有在 let、const、for、if 等语句的代码块内部才会产生。块级环境会在块代码执行前被创建，在块代码执行结束时被销毁。")]),t._v(" "),s("h2",{attrs:{id:"词法环境内部组成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#词法环境内部组成"}},[t._v("#")]),t._v(" 词法环境内部组成")]),t._v(" "),s("p",[t._v("在 JavaScript 中，每个运行的函数，代码块 "),s("code",[t._v("{...}")]),t._v(" 以及整个脚本，都有一个被称为 词法环境（Lexical Environment） 的内部（隐藏）的关联对象。")]),t._v(" "),s("p",[s("strong",[t._v("词法环境对象")]),t._v("由两部分组成：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("**环境记录（Environment Record）**一个存储变量和函数标识符以及它们的绑定关系的对象")]),t._v(" "),s("p",[t._v("1.声明式环境记录（Declarative Environment Record）")]),t._v(" "),s("p",[t._v("用来存储变量、函数声明和块级作用域声明等声明的绑定关系，例如 let、const、class、function 等声明。")]),t._v(" "),s("p",[t._v("2.对象式环境记录（Object Environment Record）")]),t._v(" "),s("p",[t._v("用来存储 this 和 with 语句等的绑定关系。对象式环境记录可以看作是一个指向外部对象的引用。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("对外部词法环境的引用")]),t._v("(Outer Lexical Environment Reference)，与外部代码相关联。")]),t._v(" "),s("p",[t._v("外部词法环境引用是指指向父级词法环境的引用，形成了一个词法环境链，用于支持词法作用域。全局环境的外部词法环境引用为 null。")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"E:\\HTMLCSSJavaScript\\myBlog\\Jiaze-blog\\docs\\笔记整理\\javascript\\js基础\\闭包与作用域.assets\\image-20230322174538826.png",alt:"image-20230322174538826"}})])]),t._v(" "),s("p",[t._v("一个“变量”只是 "),s("strong",[t._v("环境记录")]),t._v(" 这个特殊的内部对象的一个属性。“获取或修改变量”意味着“获取或修改词法环境的一个属性”。")]),t._v(" "),s("p",[s("img",{attrs:{src:"E:%5CHTMLCSSJavaScript%5CmyBlog%5CJiaze-blog%5Cdocs%5C%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86%5Cjavascript%5Cjs%E5%9F%BA%E7%A1%80%5C%E9%97%AD%E5%8C%85%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F.assets%5Cimage-20230322163803619.png",alt:"image-20230322163803619"}})]),t._v(" "),s("p",[t._v("矩形表示环境记录（变量存储），箭头表示外部引用。全局词法环境没有外部引用，所以箭头指向了 "),s("code",[t._v("null")]),t._v("。")]),t._v(" "),s("ol",[s("li",[t._v("当脚本开始运行，词法环境预先填充了所有声明的变量。\n"),s("ul",[s("li",[t._v("最初，它们处于“未初始化（Uninitialized）”状态。这是一种特殊的内部状态，这意味着引擎知道变量，但是在用 "),s("code",[t._v("let")]),t._v(" 声明前，不能引用它。几乎就像变量不存在一样。")])])]),t._v(" "),s("li",[t._v("然后 "),s("code",[t._v("let phrase")]),t._v(" 定义出现了。它尚未被赋值，因此它的值为 "),s("code",[t._v("undefined")]),t._v("。从这一刻起，我们就可以使用变量了。")]),t._v(" "),s("li",[s("code",[t._v("phrase")]),t._v(" 被赋予了一个值。")]),t._v(" "),s("li",[s("code",[t._v("phrase")]),t._v(" 的值被修改。")])]),t._v(" "),s("p",[s("strong",[t._v("词法环境是一个规范对象")])]),t._v(" "),s("p",[t._v("“词法环境”是一个规范对象（specification object）：它只存在于 "),s("a",{attrs:{href:"https://tc39.es/ecma262/#sec-lexical-environments",target:"_blank",rel:"noopener noreferrer"}},[t._v("语言规范"),s("OutboundLink")],1),t._v(" 的“理论”层面，用于描述事物是如何工作的。我们无法在代码中获取该对象并直接对其进行操作。")]),t._v(" "),s("p",[t._v("但 JavaScript 引擎同样可以优化它，比如清除未被使用的变量以节省内存和执行其他内部技巧等，但显性行为应该是和上述的无差。")]),t._v(" "),s("h2",{attrs:{id:"内部和外部的词法环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内部和外部的词法环境"}},[t._v("#")]),t._v(" 内部和外部的词法环境")]),t._v(" "),s("p",[t._v("当代码要访问一个变量时 —— 首先会搜索内部词法环境，然后搜索外部环境，然后搜索更外部的环境，以此类推，直到全局词法环境。")]),t._v(" "),s("p",[t._v("如果在任何地方都找不到这个变量，那么在严格模式下就会报错（在非严格模式下，为了向下兼容，给未定义的变量赋值会创建一个全局变量）。")]),t._v(" "),s("p",[t._v("在一个函数运行时，在调用刚开始时，会自动创建一个新的词法环境以存储这个调用的局部变量和参数。")]),t._v(" "),s("p",[s("img",{attrs:{src:"E:%5CHTMLCSSJavaScript%5CmyBlog%5CJiaze-blog%5Cdocs%5C%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86%5Cjavascript%5Cjs%E5%9F%BA%E7%A1%80%5C%E9%97%AD%E5%8C%85%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F.assets%5Cimage-20230322164701134.png",alt:"image-20230322164701134"}})]),t._v(" "),s("p",[t._v("在这个函数调用期间，我们有两个词法环境：内部一个（用于函数调用）和外部一个（全局）：")]),t._v(" "),s("ul",[s("li",[t._v("内部词法环境与 "),s("code",[t._v("say")]),t._v(" 的当前执行相对应。它具有一个单独的属性："),s("code",[t._v("name")]),t._v("，函数的参数。我们调用的是 "),s("code",[t._v('say("John")')]),t._v("，所以 "),s("code",[t._v("name")]),t._v(" 的值为 "),s("code",[t._v('"John"')]),t._v("。")]),t._v(" "),s("li",[t._v("外部词法环境是全局词法环境。它具有 "),s("code",[t._v("phrase")]),t._v(" 变量和函数本身。")])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeCounter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" counter "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeCounter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" counter2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeCounter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("counter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("counter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("counter2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ?")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("counter2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ?")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br")])]),s("p",[t._v("答案是 0和1")]),t._v(" "),s("p",[t._v("函数 "),s("code",[t._v("counter")]),t._v(" 和 "),s("code",[t._v("counter2")]),t._v(" 是通过 "),s("code",[t._v("makeCounter")]),t._v(" 的不同调用创建的。")]),t._v(" "),s("p",[t._v("因此，它们具有独立的外部词法环境，每一个都有自己的 "),s("code",[t._v("count")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"暂时性死区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#暂时性死区"}},[t._v("#")]),t._v(" 暂时性死区")]),t._v(" "),s("p",[t._v("从程序执行进入代码块（或函数）的那一刻起，变量就开始进入“未初始化”状态。它一直保持未初始化状态，直至程序执行到相应的 "),s("code",[t._v("let")]),t._v(" 语句。换句话说，一个变量从技术的角度来讲是存在的，但是在 "),s("code",[t._v("let")]),t._v(" 之前还不能使用")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// error")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("func")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("p",[s("strong",[t._v("JavaScript高级程序设计（第4版）")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://zh.javascript.info/",target:"_blank",rel:"noopener noreferrer"}},[t._v("现代 JavaScript 教程"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://segmentfault.com/a/1190000042621269",target:"_blank",rel:"noopener noreferrer"}},[t._v("深入理解JavaScript——词法环境 - 个人文章 - SegmentFault 思否"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("strong",[t._v("你不知道的 JavaScript（上卷）")])])])}),[],!1,null,null,null);s.default=e.exports}}]);