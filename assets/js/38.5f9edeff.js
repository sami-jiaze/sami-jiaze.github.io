(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{470:function(_,t,A){_.exports=A.p+"assets/img/image-20230315094607021.6497cfba.png"},603:function(_,t,A){"use strict";A.r(t);var P=A(2),v=Object(P.a)({},(function(){var _=this,t=_._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[_._v("总览")]),_._v(" "),t("p",[_._v("什么是ARP协议，ARP工作原理")])]),_._v(" "),t("h2",{attrs:{id:"arp背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arp背景"}},[_._v("#")]),_._v(" ARP背景")]),_._v(" "),t("p",[_._v("在传输一个 IP 数据报的时候，确定了源 IP 地址和目标 IP 地址后，就会通过主机「路由表」确定 IP 数据包下一跳。然而，网络层的下一层是数据链路层，所以我们还要知道「下一跳」的 MAC 地址。")]),_._v(" "),t("p",[_._v("由于主机的路由表中可以找到下一跳的 IP 地址，所以可以通过 "),t("strong",[_._v("ARP 协议")]),_._v("，求得下一跳的 MAC 地址。")]),_._v(" "),t("h2",{attrs:{id:"什么是arp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是arp"}},[_._v("#")]),_._v(" 什么是ARP")]),_._v(" "),t("p",[_._v("ARP（Address Resolution Protocol，地址解析协议）是用来将IP地址解析为MAC地址的协议。主机或三层网络设备上会维护一张ARP表，用于存储IP地址和MAC地址的映射关系")]),_._v(" "),t("p",[_._v("主机发送信息时将包含目标IP地址的ARP请求广播到局域网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源")]),_._v(" "),t("p",[_._v("简单的来说就是：在IP以太网中，当一个上层协议要发包时，有了该节点的IP地址，ARP就能提供该节点的MAC地址。")]),_._v(" "),t("h2",{attrs:{id:"arp缓存表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arp缓存表"}},[_._v("#")]),_._v(" ARP缓存表")]),_._v(" "),t("p",[_._v("操作系统通常会把第一次通过 ARP 获取的 MAC 地址缓存起来，以便下次直接从缓存中找到对应 IP 地址的 MAC 地址，ARP缓存用来存放IP地址和MAC地址的关联信息，注意 MAC 地址的缓存是有一定期限的，超过这个期限，缓存的内容将被清除。")]),_._v(" "),t("p",[_._v("ARP表项又分为动态ARP表项和静态ARP表项")]),_._v(" "),t("p",[t("strong",[_._v("动态ARP表项")])]),_._v(" "),t("p",[_._v("动态ARP表项由ARP协议通过ARP报文自动生成和维护，可以被老化，可以被新的ARP报文更新，可以被静态ARP表项覆盖。每个动态ARP缓存项的潜在生命周期是10分钟。新加到缓存中的项目带有时间戳，如果某个项目添加后2分钟内没有再使用，则此项目过期并从ARP缓存中删除；如果某个项目已在使用，则又收到2分钟的生命周期；如果某个项目始终在使用，则会另外收到2分钟的生命周期，一直到10分钟的最长生命周期。")]),_._v(" "),t("p",[t("strong",[_._v("静态ARP表项")])]),_._v(" "),t("p",[_._v("静态ARP表项通过手工配置和维护，不会被老化，不会被动态ARP表项覆盖。直到重新启动计算机为止。")]),_._v(" "),t("p",[_._v("配置静态ARP表项可以增加通信的安全性。静态ARP表项可以限制和指定IP地址的设备通信时只使用指定的MAC地址，此时攻击报文无法修改此表项的IP地址和MAC地址的映射关系，从而保护了本设备和指定设备间的正常通信。")]),_._v(" "),t("h2",{attrs:{id:"arp工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arp工作原理"}},[_._v("#")]),_._v(" ARP工作原理")]),_._v(" "),t("p",[_._v("ARP通过"),t("strong",[_._v("广播ARP请求")]),_._v("和"),t("strong",[_._v("单播ARP应答")]),_._v("这两个过程完成地址解析")]),_._v(" "),t("p",[t("img",{attrs:{src:A(470),alt:"image-20230315094607021"}})]),_._v(" "),t("p",[_._v("当需要通信的两台主机处于同一网段时，如上图中的Host_1和Host_3，Host_1要向Host_3发送数据。")]),_._v(" "),t("ol",[t("li",[_._v("首先，Host_1会查找自己本地缓存的ARP表，确定是否包含Host_3对应的ARP表项。如果Host_1在ARP表中找到了Host_3对应的MAC地址，则Host_1直接利用ARP表中的MAC地址，对数据报文进行帧封装，并将数据报文发送给Host_3。如果Host_1在ARP表中找不到Host_3对应的MAC地址，则先缓存该数据报文，并以广播方式发送一个ARP请求报文。如上图中所示，OP字段为1表示该报文为ARP请求报文，ARP请求报文中的源MAC地址和源IP地址为Host_1的MAC地址和IP地址，目的MAC地址为全0的MAC地址，目的IP地址为Host_3的IP地址。")]),_._v(" "),t("li",[_._v("Switch_1收到ARP请求报文后，将该ARP请求报文在同一广播域内转发。")]),_._v(" "),t("li",[_._v("同一广播域内的主机Host_2和Host_3都能接收到该ARP请求报文，但只有被请求的主机（即Host_3）会对该ARP请求报文进行处理。Host_3比较自己的IP地址和ARP请求报文中的目的IP地址，当两者相同时进行如下处理：将ARP请求报文中的源IP地址和源MAC地址（即Host_1的IP地址和MAC地址）存入自己的ARP表中。之后以单播方式发送ARP应答报文给Host_1，ARP应答报文内容如上图中所示，OP字段为2表示该报文为ARP应答报文，源MAC地址和源IP地址为Host_3的MAC地址和IP地址，目的MAC地址和目的IP地址为Host_1的MAC地址和IP地址。")]),_._v(" "),t("li",[_._v("Switch_1收到ARP应答报文后，将该ARP应答报文转发给Host_1。Host_1收到ARP应答报文后，将Host_3的MAC地址加入到自己的ARP表中以用于后续报文的转发，同时将数据报文进行帧封装，并将数据报文发送给Host_3。")])]),_._v(" "),t("p",[_._v("当主机A和主机B不在同一网段时，主机A就会先向网关发出ARP请求，ARP请求报文中的目标IP地址为网关的IP地址。当主机A从收到的响应报文中获得网关的MAC地址后，将报文封装并发给网关。如果网关没有主机B的ARP表项，网关会广播ARP请求，目标IP地址为主机B的IP地址，当网关从收到的响应报文中获得主机B的MAC地址后，就可以将报文发给主机B；如果网关已经有主机B的ARP表项，网关直接把报文发给主机B。")]),_._v(" "),t("h2",{attrs:{id:"arp欺骗"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#arp欺骗"}},[_._v("#")]),_._v(" ARP欺骗")]),_._v(" "),t("p",[_._v("了解ARP协议的工作原理后可以分析出其存在一个严重的安全问题：")]),_._v(" "),t("p",[_._v("在ARP回复时，发送请求包的主机A并不会验证ARP回复包的真实性，也就是不能判断回复主机A的是不是主机B。由此引出一个局域网攻击方式ARP欺骗。")]),_._v(" "),t("p",[_._v("例子")]),_._v(" "),t("ul",[t("li",[_._v("1.主机A要和主机C通信，主机A发出ARP包询问谁是192.168.1.3?请回复192.168.1.1。")]),_._v(" "),t("li",[_._v("2.这时主机B在疯狂的向主机A回复，我是192.168.1.3，我的地址是0A-11-22-33-44-02。")]),_._v(" "),t("li",[_._v("3.由于ARP协议不会验证回复者的身份，造成主机A错误的将192.168.1.3的MAC映射为0A-11-22-33-44-02。")])]),_._v(" "),t("h2",{attrs:{id:"rarp-协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rarp-协议"}},[_._v("#")]),_._v(" RARP 协议")]),_._v(" "),t("p",[_._v("RARP 协议正好相反，它是已知 MAC 地址求 IP 地址。例如将打印机服务器等小型嵌入式设备接入到网络时就经常会用得到。")]),_._v(" "),t("p",[_._v("通常这需要架设一台 "),t("code",[_._v("RARP")]),_._v(" 服务器，在这个服务器上注册设备的 MAC 地址及其 IP 地址。然后再将这个设备接入到网络，接着：")]),_._v(" "),t("ul",[t("li",[_._v("该设备会发送一条「我的 MAC 地址是XXXX，请告诉我，我的IP地址应该是什么」的请求信息。")]),_._v(" "),t("li",[_._v("RARP 服务器接到这个消息后返回「MAC地址为 XXXX 的设备，IP地址为 XXXX」的信息给这个设备。")])]),_._v(" "),t("p",[_._v("最后，设备就根据从 RARP 服务器所收到的应答信息设置自己的 IP 地址。")]),_._v(" "),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[_._v("#")]),_._v(" 参考")]),_._v(" "),t("p",[_._v("小林coding")]),_._v(" "),t("p",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/370507243",target:"_blank",rel:"noopener noreferrer"}},[_._v("彻底搞懂系列之：ARP协议 - 知乎 (zhihu.com)"),t("OutboundLink")],1)]),_._v(" "),t("p",[t("a",{attrs:{href:"https://info.support.huawei.com/info-finder/encyclopedia/zh/ARP.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("什么是ARP？它是如何进行地址解析的？ - 华为 (huawei.com)"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=v.exports}}]);